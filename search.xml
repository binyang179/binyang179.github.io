<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>kerberos认证原理</title>
      <link href="/2019/11/27/kerberos-ren-zheng-yuan-li/"/>
      <url>/2019/11/27/kerberos-ren-zheng-yuan-li/</url>
      
        <content type="html"><![CDATA[<p>一、 基本原理</p><p>Authentication解决的是“如何证明某个人确确实实就是他或她所声称的那个人”的问题。对于如何进行Authentication，我们采用这样的方法：如果一个秘密（secret）仅仅存在于A和B，那么有个人对B声称自己就是A，B通过让A提供这个秘密来证明这个人就是他或她所声称的A。这个过程实际上涉及到3个重要的关于Authentication的方面：</p><p>Secret如何表示。<br>A如何向B提供Secret。<br>B如何识别Secret。<br>基于这3个方面，我们把Kerberos Authentication进行最大限度的简化：整个过程涉及到Client和Server，他们之间的这个Secret我们用一个Key（KServer-Client）来表示。Client为了让Server对自己进行有效的认证，向对方提供如下两组信息：</p><p>代表Client自身Identity的信息，为了简便，它以明文的形式传递。<br>将Client的Identity使用KServer-Client作为Public Key、并采用对称加密算法进行加密。<br>由于KServer-Client仅仅被Client和Server知晓，所以被Client使用KServer-Client加密过的Client Identity只能被Client和Server解密。同理，Server接收到Client传送的这两组信息，先通过KServer-Client对后者进行解密，随后将机密的数据同前者进行比较，如果完全一样，则可以证明Client能过提供正确的KServer-Client，而这个世界上，仅仅只有真正的Client和自己知道KServer-Client，所以可以对方就是他所声称的那个人。</p><p>Keberos大体上就是按照这样的一个原理来进行Authentication的。但是Kerberos远比这个复杂，我将在后续的章节中不断地扩充这个过程，知道Kerberos真实的认证过程。为了使读者更加容易理解后续的部分，在这里我们先给出两个重要的概念：</p><p>Long-term Key/Master Key：在Security的领域中，有的Key可能长期内保持不变，比如你在密码，可能几年都不曾改变，这样的Key、以及由此派生的Key被称为Long-term Key。对于Long-term Key的使用有这样的原则：被Long-term Key加密的数据不应该在网络上传输。原因很简单，一旦这些被Long-term Key加密的数据包被恶意的网络监听者截获，在原则上，只要有充足的时间，他是可以通过计算获得你用于加密的Long-term Key的——任何加密算法都不可能做到绝对保密。<br>在一般情况下，对于一个Account来说，密码往往仅仅限于该Account的所有者知晓，甚至对于任何Domain的Administrator，密码仍然应该是保密的。但是密码却又是证明身份的凭据，所以必须通过基于你密码的派生的信息来证明用户的真实身份，在这种情况下，一般将你的密码进行Hash运算得到一个Hash code, 我们一般管这样的Hash Code叫做Master Key。由于Hash Algorithm是不可逆的，同时保证密码和Master Key是一一对应的，这样既保证了你密码的保密性，有同时保证你的Master Key和密码本身在证明你身份的时候具有相同的效力。</p><p>Short-term Key/Session Key：由于被Long-term Key加密的数据包不能用于网络传送，所以我们使用另一种Short-term Key来加密需要进行网络传输的数据。由于这种Key只在一段时间内有效，即使被加密的数据包被黑客截获，等他把Key计算出来的时候，这个Key早就已经过期了。<br>二、引入Key Distribution: KServer-Client从何而来</p><p>上面我们讨论了Kerberos Authentication的基本原理：通过让被认证的一方提供一个仅限于他和认证方知晓的Key来鉴定对方的真实身份。而被这个Key加密的数据包需要在Client和Server之间传送，所以这个Key不能是一个Long-term Key，而只可能是Short-term Key，这个可以仅仅在Client和Server的一个Session中有效，所以我们称这个Key为Client和Server之间的Session Key（SServer-Client）。</p><p>现在我们来讨论Client和Server如何得到这个SServer-Client。在这里我们要引入一个重要的角色：Kerberos Distribution Center-KDC。KDC在整个Kerberos Authentication中作为Client和Server共同信任的第三方起着重要的作用，而Kerberos的认证过程就是通过这3方协作完成。顺便说一下，Kerberos起源于希腊神话，是一支守护着冥界长着3个头颅的神犬，在keberos Authentication中，Kerberos的3个头颅代表中认证过程中涉及的3方：Client、Server和KDC。</p><p>对于一个Windows Domain来说，Domain Controller扮演着KDC的角色。KDC维护着一个存储着该Domain中所有帐户的Account Database（一般地，这个Account Database由AD来维护），也就是说，他知道属于每个Account的名称和派生于该Account Password的Master Key。而用于Client和Server相互认证的SServer-Client就是有KDC分发。下面我们来看看KDC分发SServer-Client的过程。</p><p>通过下图我们可以看到KDC分发SServer-Client的简单的过程：首先Client向KDC发送一个对SServer-Client的申请。这个申请的内容可以简单概括为“我是某个Client，我需要一个Session Key用于访问某个Server ”。KDC在接收到这个请求的时候，生成一个Session Key，为了保证这个Session Key仅仅限于发送请求的Client和他希望访问的Server知晓，KDC会为这个Session Key生成两个Copy，分别被Client和Server使用。然后从Account database中提取Client和Server的Master Key分别对这两个Copy进行对称加密。对于后者，和Session Key一起被加密的还包含关于Client的一些信息。</p><p>KDC现在有了两个分别被Client和Server 的Master Key加密过的Session Key，这两个Session Key如何分别被Client和Server获得呢？也许你 马上会说，KDC直接将这两个加密过的包发送给Client和Server不就可以了吗，但是如果这样做，对于Server来说会出现下面 两个问题：</p><p>由于一个Server会面对若干不同的Client, 而每个Client都具有一个不同的Session Key。那么Server就会为所有的Client维护这样一个Session Key的列表，这样做对于Server来说是比较麻烦而低效的。<br>由于网络传输的不确定性，可能出现这样一种情况：Client很快获得Session Key，并将这个Session Key作为Credential随同访问请求发送到Server，但是用于Server的Session Key确还没有收到，并且很有可能承载这个Session Key的永远也到不了Server端，Client将永远得不到认证。<br>为了解决这个问题，Kerberos的做法很简单，将这两个被加密的Copy一并发送给Client，属于Server的那份由Client发送给Server。</p><p>可能有人会问，KDC并没有真正去认证这个发送请求的Client是否真的就是那个他所声称的那个人，就把Session Key发送给他，会不会有什么问题？如果另一个人（比如Client B）声称自己是Client A，他同样会得到Client A和Server的Session Key，这会不会有什么问题？实际上不存在问题，因为Client B声称自己是Client A，KDC就会使用Client A的Password派生的Master Key对Session Key进行加密，所以真正知道Client A 的Password的一方才会通过解密获得Session Key。 </p><p>三、引入Authenticator - 为有效的证明自己提供证据</p><p>通过上面的过程，Client实际上获得了两组信息：一个通过自己Master Key加密的Session Key，另一个被Sever的Master Key加密的数据包，包含Session Key和关于自己的一些确认信息。通过第一节，我们说只要通过一个双方知晓的Key就可以对对方进行有效的认证，但是在一个网络的环境中，这种简单的做法是具有安全漏洞，为此,Client需要提供更多的证明信息，我们把这种证明信息称为Authenticator，在Kerberos的Authenticator实际上就是关于Client的一些信息和当前时间的一个Timestamp（关于这个安全漏洞和Timestamp的作用，我将在后面解释）。</p><p>在这个基础上，我们再来看看Server如何对Client进行认证：Client通过自己的Master Key对KDC加密的Session Key进行解密从而获得Session Key，随后创建Authenticator（Client Info + Timestamp）并用Session Key对其加密。最后连同从KDC获得的、被Server的Master Key加密过的数据包（Client Info + Session Key）一并发送到Server端。我们把通过Server的Master Key加密过的数据包称为Session Ticket。</p><p>当Server接收到这两组数据后，先使用他自己的Master Key对Session Ticket进行解密，从而获得Session Key。随后使用该Session Key解密Authenticator，通过比较Authenticator中的Client Info和Session Ticket中的Client Info从而实现对Client的认证。</p><p>为什么要使用Timestamp？</p><p>到这里，很多人可能认为这样的认证过程天衣无缝：只有当Client提供正确的Session Key方能得到Server的认证。但是在现实环境中，这存在很大的安全漏洞。</p><p>我们试想这样的现象：Client向Server发送的数据包被某个恶意网络监听者截获，该监听者随后将数据包座位自己的Credential冒充该Client对Server进行访问，在这种情况下，依然可以很顺利地获得Server的成功认证。为了解决这个问题，Client在Authenticator中会加入一个当前时间的Timestamp。</p><p>在Server对Authenticator中的Client Info和Session Ticket中的Client Info进行比较之前，会先提取Authenticator中的Timestamp，并同当前的时间进行比较，如果他们之间的偏差超出一个可以接受的时间范围（一般是5mins），Server会直接拒绝该Client的请求。在这里需要知道的是，Server维护着一个列表，这个列表记录着在这个可接受的时间范围内所有进行认证的Client和认证的时间。对于时间偏差在这个可接受的范围中的Client，Server会从这个这个列表中获得最近一个该Client的认证时间，只有当Authenticator中的Timestamp晚于通过一个Client的最近的认证时间的情况下，Server采用进行后续的认证流程。</p><p>Time Synchronization的重要性</p><p>上述 基于Timestamp的认证机制只有在Client和Server端的时间保持同步的情况才有意义。所以保持Time Synchronization在整个认证过程中显得尤为重要。在一个Domain中，一般通过访问同一个Time Service获得当前时间的方式来实现时间的同步。</p><p>双向认证（Mutual Authentication）</p><p>Kerberos一个重要的优势在于它能够提供双向认证：不但Server可以对Client 进行认证，Client也能对Server进行认证。</p><p>具体过程是这样的，如果Client需要对他访问的Server进行认证，会在它向Server发送的Credential中设置一个是否需要认证的Flag。Server在对Client认证成功之后，会把Authenticator中的Timestamp提出出来，通过Session Key进行加密，当Client接收到并使用Session Key进行解密之后，如果确认Timestamp和原来的完全一致，那么他可以认定Server正式他试图访问的Server。</p><p>那么为什么Server不直接把通过Session Key进行加密的Authenticator原样发送给Client，而要把Timestamp提取出来加密发送给Client呢？原因在于防止恶意的监听者通过获取的Client发送的Authenticator冒充Server获得Client的认证。</p><p>四、引入Ticket Granting  Service</p><p>通过上面的介绍，我们发现Kerberos实际上一个基于Ticket的认证方式。Client想要获取Server端的资源，先得通过Server的认证；而认证的先决条件是Client向Server提供从KDC获得的一个有Server的Master Key进行加密的Session Ticket（Session Key + Client Info）。可以这么说，Session Ticket是Client进入Server领域的一张门票。而这张门票必须从一个合法的Ticket颁发机构获得，这个颁发机构就是Client和Server双方信任的KDC， 同时这张Ticket具有超强的防伪标识：它是被Server的Master Key加密的。对Client来说， 获得Session Ticket是整个认证过程中最为关键的部分。</p><p>上面我们只是简单地从大体上说明了KDC向Client分发Ticket的过程，而真正在Kerberos中的Ticket Distribution要复杂一些。为了更好的说明整个Ticket Distribution的过程，我在这里做一个类比。现在的股事很火爆，上海基本上是全民炒股，我就举一个认股权证的例子。有的上市公司在股票配股、增发、基金扩募、股份减持等情况会向公众发行认股权证，认股权证的持有人可以凭借这个权证认购一定数量的该公司股票，认股权证是一种具有看涨期权的金融衍生产品。</p><p>而我们今天所讲的Client获得Ticket的过程也和通过认股权证购买股票的过程类似。如果我们把Client提供给Server进行认证的Ticket比作股票的话，那么Client在从KDC那边获得Ticket之前，需要先获得这个Ticket的认购权证，这个认购权证在Kerberos中被称为TGT：Ticket Granting Ticket，TGT的分发方仍然是KDC。</p><p>我们现在来看看Client是如何从KDC处获得TGT的：首先Client向KDC发起对TGT的申请，申请的内容大致可以这样表示：“我需要一张TGT用以申请获取用以访问所有Server的Ticket”。KDC在收到该申请请求后，生成一个用于该Client和KDC进行安全通信的Session Key（SKDC-Client）。为了保证该Session Key仅供该Client和自己使用，KDC使用Client的Master Key和自己的Master Key对生成的Session Key进行加密，从而获得两个加密的SKDC-Client的Copy。对于后者，随SKDC-Client一起被加密的还包含以后用于鉴定Client身份的关于Client的一些信息。最后KDC将这两份Copy一并发送给Client。这里有一点需要注意的是：为了免去KDC对于基于不同Client的Session Key进行维护的麻烦，就像Server不会保存Session Key（SServer-Client）一样，KDC也不会去保存这个Session Key（SKDC-Client），而选择完全靠Client自己提供的方式。</p><p>当Client收到KDC的两个加密数据包之后，先使用自己的Master Key对第一个Copy进行解密，从而获得KDC和Client的Session Key（SKDC-Client），并把该Session 和TGT进行缓存。有了Session Key和TGT，Client自己的Master Key将不再需要，因为此后Client可以使用SKDC-Client向KDC申请用以访问每个Server的Ticket，相对于Client的Master Key这个Long-term Key，SKDC-Client是一个Short-term Key，安全保证得到更好的保障，这也是Kerberos多了这一步的关键所在。同时需要注意的是SKDC-Client是一个Session Key，他具有自己的生命周期，同时TGT和Session相互关联，当Session Key过期，TGT也就宣告失效，此后Client不得不重新向KDC申请新的TGT，KDC将会生成一个不同Session Key和与之关联的TGT。同时，由于Client Log off也导致SKDC-Client的失效，所以SKDC-Client又被称为Logon Session Key。</p><p>接下来，我们看看Client如何使用TGT来从KDC获得基于某个Server的Ticket。在这里我要强调一下，Ticket是基于某个具体的Server的，而TGT则是和具体的Server无关的，Client可以使用一个TGT从KDC获得基于不同Server的Ticket。我们言归正传，Client在获得自己和KDC的Session Key（SKDC-Client）之后，生成自己的Authenticator以及所要访问的Server名称的并使用SKDC-Client进行加密。随后连同TGT一并发送给KDC。KDC使用自己的Master Key对TGT进行解密，提取Client Info和Session Key（SKDC-Client），然后使用这个SKDC-Client解密Authenticator获得Client Info，对两个Client Info进行比较进而验证对方的真实身份。验证成功，生成一份基于Client所要访问的Server的Ticket给Client，这个过程就是我们第二节中介绍的一样了。 </p><p>五、Kerberos的3个Sub-protocol：整个Authentication</p><p>通过以上的介绍，我们基本上了解了整个Kerberos authentication的整个流程：整个流程大体上包含以下3个子过程：</p><p>Client向KDC申请TGT（Ticket Granting Ticket）。<br>Client通过获得TGT向DKC申请用于访问Server的Ticket。<br>Client最终向为了Server对自己的认证向其提交Ticket。<br>不过上面的介绍离真正的Kerberos Authentication还是有一点出入。Kerberos整个认证过程通过3个sub-protocol来完成。这个3个Sub-Protocol分别完成上面列出的3个子过程。这3个sub-protocol分别为：</p><p>Authentication Service Exchange<br>Ticket Granting Service Exchange<br>Client/Server Exchange<br>下图简单展示了完成这个3个Sub-protocol所进行Message Exchange。</p><p>1． Authentication Service Exchange</p><p>通过这个Sub-protocol，KDC（确切地说是KDC中的Authentication Service）实现对Client身份的确认，并颁发给该Client一个TGT。具体过程如下：</p><p>Client向KDC的Authentication Service发送Authentication Service Request（KRB_AS_REQ）, 为了确保KRB_AS_REQ仅限于自己和KDC知道，Client使用自己的Master Key对KRB_AS_REQ的主体部分进行加密（KDC可以通过Domain 的Account Database获得该Client的Master Key）。KRB_AS_REQ的大体包含以下的内容：</p><p>Pre-authentication data：包含用以证明自己身份的信息。说白了，就是证明自己知道自己声称的那个account的Password。一般地，它的内容是一个被Client的Master key加密过的Timestamp。<br>Client name &amp; realm: 简单地说就是Domain name\Client<br>Server Name：注意这里的Server Name并不是Client真正要访问的Server的名称，而我们也说了TGT是和Server无关的（Client只能使用Ticket，而不是TGT去访问Server）。这里的Server Name实际上是KDC的Ticket Granting Service的Server Name。<br>AS（Authentication Service）通过它接收到的KRB_AS_REQ验证发送方的是否是在Client name &amp; realm中声称的那个人，也就是说要验证发送放是否知道Client的Password。所以AS只需从Account Database中提取Client对应的Master Key对Pre-authentication data进行解密，如果是一个合法的Timestamp，则可以证明发送放提供的是正确无误的密码。验证通过之后，AS将一份Authentication Service Response（KRB_AS_REP）发送给Client。KRB_AS_REQ主要包含两个部分：本Client的Master Key加密过的Session Key（SKDC-Client：Logon Session Key）和被自己（KDC）加密的TGT。而TGT大体又包含以下的内容：</p><p>Session Key: SKDC-Client：Logon Session Key<br>Client name &amp; realm: 简单地说就是Domain name\Client<br>End time: TGT到期的时间。<br>Client通过自己的Master Key对第一部分解密获得Session Key（SKDC-Client：Logon Session Key）之后，携带着TGT便可以进入下一步：TGS（Ticket Granting Service）Exchange。</p><p>2． TGS（Ticket Granting Service）Exchange</p><p>TGS（Ticket Granting Service）Exchange通过Client向KDC中的TGS（Ticket Granting Service）发送Ticket Granting Service Request（KRB_TGS_REQ）开始。KRB_TGS_REQ大体包含以下的内容：</p><p>TGT：Client通过AS Exchange获得的Ticket Granting Ticket，TGT被KDC的Master Key进行加密。<br>Authenticator：用以证明当初TGT的拥有者是否就是自己，所以它必须以TGT的办法方和自己的Session Key（SKDC-Client：Logon Session Key）来进行加密。<br>Client name &amp; realm: 简单地说就是Domain name\Client。<br>Server name &amp; realm: 简单地说就是Domain name\Server，这回是Client试图访问的那个Server。<br>TGS收到KRB_TGS_REQ在发给Client真正的Ticket之前，先得整个Client提供的那个TGT是否是AS颁发给它的。于是它不得不通过Client提供的Authenticator来证明。但是Authentication是通过Logon Session Key（SKDC-Client）进行加密的，而自己并没有保存这个Session Key。所以TGS先得通过自己的Master Key对Client提供的TGT进行解密，从而获得这个Logon Session Key（SKDC-Client），再通过这个Logon Session Key（SKDC-Client）解密Authenticator进行验证。验证通过向对方发送Ticket Granting Service Response（KRB_TGS_REP）。这个KRB_TGS_REP有两部分组成：使用Logon Session Key（SKDC-Client）加密过用于Client和Server的Session Key（SServer-Client）和使用Server的Master Key进行加密的Ticket。该Ticket大体包含以下一些内容：</p><p>Session Key：SServer-Client。<br>Client name &amp; realm: 简单地说就是Domain name\Client。<br>End time: Ticket的到期时间。<br>Client收到KRB_TGS_REP，使用Logon Session Key（SKDC-Client）解密第一部分后获得Session Key（SServer-Client）。有了Session Key和Ticket，Client就可以之间和Server进行交互，而无须在通过KDC作中间人了。所以我们说Kerberos是一种高效的认证方式，它可以直接通过Client和Server双方来完成，不像Windows NT 4下的NTLM认证方式，每次认证都要通过一个双方信任的第3方来完成。</p><p>我们现在来看看 Client如果使用Ticket和Server怎样进行交互的，这个阶段通过我们的第3个Sub-protocol来完成：CS（Client/Server ）Exchange。</p><p>3． CS（Client/Server ）Exchange</p><p>这个已经在本文的第二节中已经介绍过，对于重复发内容就不再累赘了。Client通过TGS Exchange获得Client和Server的Session Key（SServer-Client），随后创建用于证明自己就是Ticket的真正所有者的Authenticator，并使用Session Key（SServer-Client）进行加密。最后将这个被加密过的Authenticator和Ticket作为Application Service Request（KRB_AP_REQ）发送给Server。除了上述两项内容之外，KRB_AP_REQ还包含一个Flag用于表示Client是否需要进行双向验证（Mutual Authentication）。</p><p>Server接收到KRB_AP_REQ之后，通过自己的Master Key解密Ticket，从而获得Session Key（SServer-Client）。通过Session Key（SServer-Client）解密Authenticator，进而验证对方的身份。验证成功，让Client访问需要访问的资源，否则直接拒绝对方的请求。</p><p>对于需要进行双向验证，Server从Authenticator提取Timestamp，使用Session Key（SServer-Client）进行加密，并将其发送给Client用于Client验证Server的身份。</p><p>六、User2User Sub-Protocol：有效地保障Server的安全</p><p>通过3个Sub-protocol的介绍，我们可以全面地掌握整个Kerberos的认证过程。实际上，在Windows 2000时代，基于Kerberos的Windows Authentication就是按照这样的工作流程来进行的。但是我在上面一节结束的时候也说了，基于3个Sub-protocol的Kerberos作为一种Network Authentication是具有它自己的局限和安全隐患的。我在整篇文章一直在强调这样的一个原则：以某个Entity的Long-term Key加密的数据不应该在网络中传递。原因很简单，所有的加密算法都不能保证100%的安全，对加密的数据进行解密只是一个时间的过程，最大限度地提供安全保障的做法就是：使用一个Short-term key（Session Key）代替Long-term Key对数据进行加密，使得恶意用户对其解密获得加密的Key时，该Key早已失效。但是对于3个Sub-Protocol的C/S Exchange，Client携带的Ticket却是被Server Master Key进行加密的，这显现不符合我们提出的原则，降低Server的安全系数。</p><p>所以我们必须寻求一种解决方案来解决上面的问题。这个解决方案很明显：就是采用一个Short-term的Session Key，而不是Server Master Key对Ticket进行加密。这就是我们今天要介绍的Kerberos的第4个Sub-protocol：User2User Protocol。我们知道，既然是Session Key，仅必然涉及到两方，而在Kerberos整个认证过程涉及到3方：Client、Server和KDC，所以用于加密Ticket的只可能是Server和KDC之间的Session Key（SKDC-Server）。</p><p>我们知道Client通过在AS Exchange阶段获得的TGT从KDC那么获得访问Server的Ticket。原来的Ticket是通过Server的Master Key进行加密的，而这个Master Key可以通过Account Database获得。但是现在KDC需要使用Server和KDC之间的SKDC-Server进行加密，而KDC是不会维护这个Session Key，所以这个Session Key只能靠申请Ticket的Client提供。所以在AS Exchange和TGS Exchange之间，Client还得对Server进行请求已获得Server和KDC之间的Session Key（SKDC-Server）。而对于Server来说，它可以像Client一样通过AS Exchange获得他和KDC之间的Session Key（SKDC-Server）和一个封装了这个Session Key并被KDC的Master Key进行加密的TGT，一旦获得这个TGT，Server会缓存它，以待Client对它的请求。我们现在来详细地讨论这一过程。</p><p>上图基本上翻译了基于User2User的认证过程，这个过程由4个步骤组成。我们发现较之我在上面一节介绍的基于传统3个Sub-protocol的认证过程，这次对了第2部。我们从头到尾简单地过一遍：</p><p>AS Exchange：Client通过此过程获得了属于自己的TGT，有了此TGT，Client可凭此向KDC申请用于访问某个Server的Ticket。<br>这一步的主要任务是获得封装了Server和KDC的Session Key（SKDC-Server）的属于Server的TGT。如果该TGT存在于Server的缓存中，则Server会直接将其返回给Client。否则通过AS Exchange从KDC获取。<br>TGS Exchange：Client通过向KDC提供自己的TGT，Server的TGT以及Authenticator向KDC申请用于访问Server的Ticket。KDC使用先用自己的Master Key解密Client的TGT获得SKDC-Client，通过SKDC-Client解密Authenticator验证发送者是否是TGT的真正拥有者，验证通过再用自己的Master Key解密Server的TGT获得KDC和Server 的Session Key（SKDC-Server），并用该Session Key加密Ticket返回给Client。<br>C/S Exchange：Client携带者通过KDC和Server 的Session Key（SKDC-Server）进行加密的Ticket和通过Client和Server的Session Key（SServer-Client）的Authenticator访问Server，Server通过SKDC-Server解密Ticket获得SServer-Client，通过SServer-Client解密Authenticator实现对Client的验证。<br>这就是整个过程。</p><p>七、Kerberos的优点</p><p>分析整个Kerberos的认证过程之后，我们来总结一下Kerberos都有哪些优点：</p><p>1．较高的Performance</p><p>虽然我们一再地说Kerberos是一个涉及到3方的认证过程：Client、Server、KDC。但是一旦Client获得用过访问某个Server的Ticket，该Server就能根据这个Ticket实现对Client的验证，而无须KDC的再次参与。和传统的基于Windows NT 4.0的每个完全依赖Trusted Third Party的NTLM比较，具有较大的性能提升。</p><p>2．实现了双向验证（Mutual Authentication）</p><p>传统的NTLM认证基于这样一个前提：Client访问的远程的Service是可信的、无需对于进行验证，所以NTLM不曾提供双向验证的功能。这显然有点理想主义，为此Kerberos弥补了这个不足：Client在访问Server的资源之前，可以要求对Server的身份执行认证。</p><p>3．对Delegation的支持</p><p>Impersonation和Delegation是一个分布式环境中两个重要的功能。Impersonation允许Server在本地使用Logon 的Account执行某些操作，Delegation需用Server将logon的Account带入到另过一个Context执行相应的操作。NTLM仅对Impersonation提供支持，而Kerberos通过一种双向的、可传递的（Mutual 、Transitive）信任模式实现了对Delegation的支持。</p><p>4．互操作性（Interoperability）</p><p>Kerberos最初由MIT首创，现在已经成为一行被广泛接受的标准。所以对于不同的平台可以进行广泛的互操作。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>An Enemy of the State</title>
      <link href="/2019/11/23/an-enemy-of-the-state/"/>
      <url>/2019/11/23/an-enemy-of-the-state/</url>
      
        <content type="html"><![CDATA[<blockquote><p><em>An Enemy of the State is “something is worse than violence”</em></p></blockquote><p>My  name is Simon Cheng and this is my statement regarding the events of August 2019:</p><p>Major points of the statement:</p><ol><li><em>I did no harm and did nothing I regret to anyone and all the people I love and cherish.</em></li><li><em>I deny the arbitrary accusations against me made by the authorities which were obtained through an illegal process, includes using torture, threats and coercion.</em></li><li><em>I won’t seek a judicial remedy as I have no confidence and trust in the opaque Chinese judicial system and after enduring such a terrible experience.</em></li><li><em>I anonymise and avoid mentioning certain details of the case in order to protect innocent people who may get into trouble from this exposure.</em></li><li><em>I speak out now because the case is relevant to the public interest on knowing the flawed judicial process in Mainland China, but I have tried my best to protect personal privacy.</em></li><li><em>I condemn the witch hunt made by Chinese Communist Party mouthpieces, esp. the political labelling of “anti-China”.</em></li><li><em>I have not fully recovered from the trauma of what happened to me and because of the greater risk of retaliation that I face, I will give no further comment on the case.</em></li></ol><p>The rest of an account</p><p>I personally support the pro-democracy movement and joined the Hong Kong protests in 2019, including maintaining and safeguarding the Lennon Wall in Jordan, but I did nothing illegal or illegitimate during the events.</p><p>British Consulate-General Hong Kong instructed staff to collect information about the status of protests in order to evaluate travel alerts and whether British[w3]  Citizens are involved. This involved joining Telegram groups, LIHKG discussion broad, and monitoring news channels. This also included approaching protestor groups to learn more about their goals.</p><p>I knew some Mainland Chinese who participated in the Hong Kong protests. A few of them were arrested by Hong Kong police and released on bail afterwards.</p><p>I tried organising a study circle on social sciences, esp. academic books on Chinese society, in Hong Kong. The members are HongKongers and Mainlanders with a background in government, banking, law, and literature.</p><p>On 8 August 2019, I travelled to Shenzhen for a business trip. I got a massage for relaxation after work hours, then met the parents of a mainland protestor to bring money back for his living cost to go through the judicial process in Hong Kong.</p><p>I had heard the rumours that HongKongers would be targeted at border checkpoints for examinations of cell-phone for evidence of attendance or support of the protests. I arranged with my girlfriend and friends that I would keep reporting my whereabouts and safety.</p><p>I was stopped while I was passing through the border from Mainland within Hong Kong West Kowloon Highspeed Railway Station, after I took the high-speed train from Shenzhen Futian Railway Station. The uniformed police wore wear tiny cameras on their shoulders and started to film me.</p><p>In the Hong Kong West Kowloon Railway Station (Mainland Chinese) Police Station, the uniformed police claimed they stopped me because of the order instructed by senior officials. They said they don’t know the reasons or details.</p><p>They asked for the passcode to access my iPhone. I refused because it is a work phone which contains sensitive work information and private conversations (including political comments criticising authorities) with friends.</p><p>From this police station I was sent to Shenzhen by high-speed train and handed over to plainclothes police officers. I later learnt they are from the State Security Bureau (the political/secret police). Unlike the uniformed police who had shown politeness in West Kowloon Station, they were rude and rough and started interrogating me in the Futian police station.</p><p>Before the interrogations began, they took “prisoner photos” (holding a name plate and being photographed all around in front of the height ruler). They tried to connect my iPhone to their computer to extract its content and download a backup (it probably failed as they didn’t get my passcode at that moment), and obtained my biometric information through blood and urine test, full palmprints and fingerprints, etc.</p><p>During the interrogation, I was in a cell siting on a steel “tiger chair.” I had been buckled up on the chair and cannot move.</p><p>I was asked three types of question: 1.) The UK role in the Hong Kong “riots”; 2.) my role in the “riots”; and 3.) my relations with mainlanders who joined the “riots”.</p><p>Interrogators called me a “man in black”, which is a name usually used for the young protestors in Hong Kong. They criticised and lamented me working for the UK to attract investment leaving the country, while the world is now coming to China and kowtowing to China for better business opportunities.</p><p>Interrogators said although my words and actions against the country and the party had been practiced in Hong Kong, I can be punished based on Mainland law once in Mainland China, as Hong Kong is a part of China.</p><p>After being questioned for an entire day, I was transferred to another police station in Lo Wu. Police did this so the time in detention for questioning without charge could be prolonged for another 24 hours. Perhaps they can do this indefinitely. From this point until my release, I was not allowed to wear my glasses and felt dizzy all the time.</p><p>In the police car, secret police played the song - “The Grand Earth” by the Hong Kong band “Beyond”. The lyrics mentioned a person need to be separated from the hometown and the family in the coming indefinite future.</p><p>The uniformed police whispered that I was handed over from “State Security Bureau” and a senior leader instructed that I will be charged as a “criminal suspect of armed rebellion and rioting”.</p><p>At Lo Wu Police Station, I redid the enrolment procedures (took prisoner photos, body check, DNA test, urine test, biometric info collection, etc). In the interrogation room was around 10 officers, half in plainclothes (secret police) and half in uniform (civilian police). They again asked but failed to get my iPhone passcode.</p><p>Secret police let the civilian uniformed police lead the interrogation. They claimed that external sources reported that I “solicited prostitution”. If I cooperate then I will face a less hard treatment. I would not get a criminal record under administrative detention. The alternative was indefinite criminal detention, severe criminal charge and harsh treatment handled by secret police. I have no choice but to give a confession.</p><p>During the interrogation, I was not allowed to contact my family even after 24 hours. They claimed my case will be reported to my family by the police sending a written letter to Interpol which will then be forwarded to Hong Kong police, then Hong Kong police will send letter to my family. However, they are “not sure when will Hong Kong police know because they are too busy to handle what I clearly know (hinting at the protests)”. (After my release, I noted that my family actually didn’t receive any official letter about my status and whereabouts).</p><p>Because the administrative detention does not have to go through the due process of trial at court, I was also not allowed to call for legal support from lawyers.</p><p>After giving a confession, I can sense the secret police were relieved and left the room. I was taken back to a cell to wait for the “administrative penalty decision” document, which is solely and arbitrarily decided by the police.</p><p>During the time in the cell waiting for “decision document” on penalty, “inmates” asked me very tricky and unusual questions. One who looked like a slim drug-addict asked how to obtain a US passport to join an army against China. I inferred that they may be undercovers, so I didn’t touch much sensitive issues, and they were soon escorted out of the custody by two uniformed guards.</p><p>One uniformed police officer came over with “decision document” for me to sign with fingerprints. They left the period of detention (from when to when) field blank and ordered me to press fingerprint on it. They intended to interpret the period of my imprisonment whenever they need.</p><p>They made a maximum penalty of up to 15-day administrative detention but the paper left blank the space to indicate the starting date. I believe it was a tactic to secretly and arbitrarily incarcerate me for an even longer period.</p><p>The police officer told me that the decision had been made at a very senior level – “Bureau Chief”. However, he didn’t elaborate and asked will I lose my job, but I didn’t reply.</p><p>After several hours back in the cell, I was handcuffed and delivered to a biometric collection centre for detention. This was already the third time to do the enrolment procedure (prisoner photo, blood test, urine test, etc…) but the first time I experienced being handcuffed, shackled, wearing a prison jumpsuit, and undergoing a naked body check.</p><p>Then I was sent to Lo Wu detention centre. I suspect the secret police hadn’t yet told the civilian police and correctional officers in the centre about the sensitivity of my case, so the detention centre managers put me in a cell with around 16 mainland inmates who were minor law offenders.</p><p>I had the happiest moment in detention with these inmates, as I finally had a chance to chat, and they were kind and shared pears, bread, biscuits, cakes, and pickles (I was exclusively ineligible to buy all these).</p><p>While chatting with these inmates, they had doubts about the police case against me. They mentioned I shouldn’t be sentenced and treated that harshly, and the way and location I was captured was unusual and weird. They believe I was targeted politically.</p><p>As they knew I was not allowed to communicate with my parents, one of the inmates agreed to help convey a message after he was to be released after few days. I left my home phone number with a message: “I was detained because of what is happening in Hong Kong. Don’t come to Mainland”.</p><p>I was then taken out for interrogation over “political crimes”, with similar questions being asked as before. I was brought back to the cell around midnight. After that, inmates didn’t dare to look at me, and they whispered that “we can’t talk to you otherwise we can’t be released too”. I sensed they were being threatened and warned. Certainly, no message can be sent out.</p><p>From the second day in the detention centre onwards, I was held in solitary confinement for the rest of the detention period. The law for administrative detainees’ welfare and rights, which clearly states that inmates are allowed to meet or call parents at least once per week and two-hour activities outside the cell per day, were exclusively not applied to me.</p><p>Since then, I was interrogated for days and days, hours after hours. I can’t get double confirmation from authorities what was the exact release date. For sure I didn’t know if it will truly be the end after the proposed 15-day detention.</p><p>I was handcuffed and interrogated within the detention centre; secret police arrived and the detention centre staff and correctional officers monitored the whole process. Secret police forced me to open my iPhone by grabbing my hair to do the facial recognition. The interrogator said: “We suspect you are a British spy and secret agent”. After they used violence, I gave my passcode.</p><p>Correctional officers and detention centre staff seemed a bit shocked when they saw the violence. Secret police asked them to lock me up with handcuffs on the bar attached to the tiger chair. Although they seemed hesitant, they followed the orders to do so.</p><p>In the following days, secret police took me out of the detention centre for interrogations. The head of the detention centre instructed doctors to do a full body check every time I was taken and returned to the detention centre, before and after the questionings.</p><p>As the unit which held me (civilian police) and the unit which interrogated me (secret police) are from different systems, I sensed that the secret police are less monitored to do interrogation using torture outside the detention centre. The detention centre managers have less responsibility if physical harm to me is caused outside their facilities.</p><p>When the secret police took me out of the detention centre, I was handcuffed, shackled, blindfolded and hooded (so it was hard to breathe). I was not allowed to wear glasses from the very beginning, so I kept feeling dizzy and suffocated.</p><p>Before I was blindfolded, I glimpsed a private van outside. They asked me to wear the prison jumpsuit and vest inside-out (for hiding my identity and information from others outside), then I was handcuffed, shackled, blindfolded and hooded. They dragged me into the private van, then instructed me to lay on the rear bench seat (trying not let others outside see me). It felt like a kidnapping.</p><p>It was around 30-40 minute drive, then I was delivered to an unknown place. That area was quiet and seemed like a secluded place. I was dragged through grassy areas, went up a few steps, then put into a room. I heard the sound of moving something like furniture, I realised that may be the tools for torture. I said: “I will confess whatever you want, torture is not necessary”. They said it is not torture but “training”.</p><p>I was hung (handcuffed and shackled) on a steep X-Cross doing a spread-eagled pose for hours after hours. I was forced to keep my hands up, so blood cannot be pumped up my arms. It felt extremely painful.</p><p>Sometimes, they ordered me to do the “stress tests”, which includes extreme strength exercise such as “squat” and “chair pose” for countless hours. They beat me every time I failed to do so using something like sharpened batons. They also poked my vulnerable and shivering body parts, such as knee joint. I was blindfolded and hooded during the whole torture and interrogations, I sweated a lot, and felt exhausted, dizzy and suffocated.</p><p>When they fed me during a short break between torture (I was still handcuffed, shackled, and blindfolded), they started to do politically correctional education and united front work. They said China is a country where it is not suitable to have full democracy at the moment because the majority of the population are still not well educated, and statecraft and good governance are highly professional skills which can only be managed and handled by a selective and capable minority. The so-called liberal democracy that empowered the mass public could only be populism which justifies what is wrong is right. They gave a historical example - Nicolaus Copernicus - a Renaissance-era astronomer who was targeted and bullied by the mass public just because he formulated a model that challenged the popular (church) belief by saying the Sun rather than Earth is at the centre of the universe. The interrogators showed an elitism mindset.</p><p>Sometimes, they instructed me to stand still (handcuffed, shackled, blindfolded, and hooded) for hours after hours. I was not allowed to move and fall asleep, and if I did, then I would be punished by being forced to sing the Chinese national anthem, which they said can “wake me up”. This was the non-physical torture – sleep deprivation - they used against me.</p><p>While being subjected to this torture, I was not allowed to say even one word. They said they had a “rule” that I should seek their permission to speak (by saying “report, my master”). If I didn’t follow this rule, then they slapped my mouth and face with unknown weapons (felt like a sharpen baton).</p><p>One low male voice spoke native Cantonese and his accent is similar to HongKongers. He said: “how dare you work for the British to supervise Chinese, you would be treated worsen than shit”. Another male voice with northern-accented Mandarin said: “We are from secret intelligence service. You are also part of it [intelligence service] as Embassy/ Consulate is a publicly recognised spy agency. Therefore, you should know you have no human rights in this place”.</p><p>They started asking me if I know MI5 and MI6, anyone who seemingly work for both agencies, the building structure of the British Consulate-General Hong Kong, what floor for what departments and what the staff passes look like, etc.</p><p>They were unhappy with the “question and answer” model, so requested that I proactively confess the “crimes I committed” regardless of what questions they ask. They expected I can complete their plot about “foreign meddling” in the Hong Kong protests.</p><p>They expected me to confess 1.) UK instigates the riots in Hong Kong by donating money, materials and equipment; 2.) I organise, participate and incite the protest in violent way; 3.) I pay the bail, using my salary from UK government, for those mainlanders who were arrested by Hong Kong police.</p><p>Realising the seriousness of the crime they accused me of would probably mean I would be sentenced for over decades or even for life in prison, I solemnly denied the accusations no matter how harsh I was treated.</p><p>In the first week, the secret police saw I was seriously bruised on ankles, thighs, wrists, and knees, so they ordered me to not tell the truth to the doctors back in detention centre, and to claim it was because I slipped on the floor during the interrogations outside of the detention center. The doctors jotted down my injuries on the medical record in the detention centre.</p><p>Realising I can’t even walk in the following days, they paused physical torture but did more psychological way. In the second week, I was still in solitary confinement with no communication and no questionings for three consecutive days. In this solitude, I meditated, prayed (while I cried) and sang for killing time and calming me down while I faced uncertainty.</p><p>The secret police brought ointment and oil to heal my physical injuries, and tried to have my bruises and wounds fade away quickly.</p><p>In the following days, they took me out to the “collective investigation centre” which is a place where police apply for a room for interrogation. I was allowed to take off the blindfold inside the centre. I saw the secret police filling out forms in the reception/ registration counter, and they wrote “secret” on my case file while applying for an interrogation room there.</p><p>Then I saw around 10 young “criminal suspects” who were receiving interrogations in the centre. They are all handcuffed and in orange prisoner vest. When I walked through the corridor, I heard one voice shout out from one of the questioning rooms: “raise your hands higher! Didn’t you raise your hands and wave the flags in the protest?!” I guess they were torturing Hong Kong protestors.</p><p>In the interrogation room, I was accused of “avoided the heavy and choosing the light”, basically hinting I chose to confess the minor offence (soliciting prostitution) rather than the serious crimes (armed rebellion and rioting).</p><p>While asking why the protestors are becoming violent and the valour groups (using aggressive tactics) are proliferating, I mentioned it is a self-defence response to the Yuen Long Men-in-White Attack on 21 and 22 July. It is commonly suspected the triad gangsters and thugs, who attacked protestors and citizens, were instructed and paid by pro-Beijing lawmaker Junius Ho Kwan-yiu, and the Hong Kong police were also suspected of conspiring in the attack. The interrogators felt angry and replied there is no need to pay attackers, because they and other patriotic Chinese should and will voluntarily go across the border and beat rioters, if the border gate can be opened and even removed.</p><p>One new secret police came over and behaved very rudely, he pointed at my face and shouted in Mandarin: “you are a traitor to the motherland!” He also quoted Maoism theory - “People’s Democratic Dictatorship” that: “we noted you are a so-called pro-democrat, but you should know we rule democratically to most of the Chinese people, however, we rule autocratically on you because you are our ‘state enemy”. He also “guaranteed” that I will not be released after 15 days because I will be further charged with at least “subversion” afterwards. He claimed that he is prepared to bet his career on my further imprisonment.</p><p>He probably knew the reason why I didn’t lose my sanity was because the hope, no matter how grim my treatment, that I was going to be released after 15 days. While facing this hostility, I lost my will to fight for survival, and replied I will commit suicide if there is no definite end of my detention after 15 days. His response was furious and said it should be my destiny, as a failed spy, to accomplish this duty - terminating a life.</p><p>After this I had no appetite to have a meal in the room. Another secret police told me I still have a choice to be “reborn” (released) after 15 days if I act in a “cooperative attitude” by giving more information about the connection between the protests and the UK. I insisted I was just a peripheral participant and didn’t protest violently. He replied, “something is far worse than violence”, “it is impossible you are peripheral from the anti-government movement as we can sense you have potential and political ambition based on your background”, hinting that I am suspected as a mastermind and British proxy behind the protests.</p><p>That was the second time I cried. I mentioned that I only want is simply to be reunited with my girlfriend and family in Hong Kong. I felt deeply sorry for them who are suffering because of my belief in democracy. Then I kneeled and begged for mercy. They rejected it and asked me to stand up.</p><p>While escorting me out of the “collective investigation centre”, I saw one young girl who was doing the enrolment procedure (handcuffed, wearing prisoner vest, body check, etc.). The secret police who was handling my case clearly stated that: “honestly, she is one of the scums who was caught because of joining the anti-government protest in Hong Kong”. He asked if I knew and recognised her, I shook head.</p><p>On the private van back to the detention centre, I was blindfolded again. One secret police told me to calm down. Another secret police asked me what does the mass public think of China, and said that I can tell him the truth.</p><p>I replied: “Most HongKongers recognise the speedy business development, mass infrastructure building and technology advancement in recent decades, and do appreciate that people can benefit from such big leaps in modernisation and start to be proud as Chinese in the international arena. However, the growing party-state nationalism prevailing in younger generations had shown intolerance and assertiveness towards political dissidents and those in peripheral regions. When people believe in nothing but power and wealth, it reinforces authoritarianism and economic and military expansion is inevitable. When minorities face the trade-off between ‘patriots’ and ‘democrats’, and between ‘economic interest’ and ‘political freedom’, people make a choice and take side. I believe people who are advocating for more liberal democracy are unnecessarily called separatists. If they are welcomed in the country, they can be patriotic establishment[w4] .”</p><p>I also asked if I can be transferred to a “concentration camp” in Xinjiang if I have to be under unlimited detention for further political charges because I can at least exercise and do something meaningful, such as planting trees while chatting with inmates with better scenery, rather than wasting away in solitary confinement, waiting for nothing in a cell.</p><p>Secret police were a bit angry and said, “concentration camp is from Nazi regime”, and asked from which media I heard about this. I corrected myself and said that it should be “re-education and training camp” which I heard from CCTV. They were silent.</p><p>The driver broke the silence and stopped the conversation by criticising me with disdain: “cheating for sympathy”.</p><p>That was the last day I was interrogated outside of the detention centre. Since Day 11 (which is the timing I later learned after I was released that my disappearance had been reported on the global news), I was interrogated back within the detention centre again, and they treated me more gently.</p><p>In the following days, the secret police summoned me to the interrogation room. This time, before I got in the room, doctor did body check, and told me this would be the last interrogation. In the room, I saw only one plainclothes officer there, and I never ever seen him before. The interrogation is surprisingly short compared with previous questionings. He suddenly emphasised why I was detained is merely because of “soliciting prostitution”, and that what I did in Hong Kong is none of their business as it is out of their jurisdiction. I was confused as what he said is exactly the opposite from what they told me on Day 1.</p><p>He repeatedly told me senior leaders were looking into my “attitude”, and he claimed they were undecided on whether to let me go after 15-day detention. He showed two different types of “decision documents”, one is for 15-day detention as originally proposed and signed before, and the other one is for two more years, in the name of “Re-education through sheltering”.</p><p>He said the police have ultimate power to decide whether I can be further imprisoned for two more years, and he read clauses about their power out to me. What I later understood (after I was released), is that police have arbitrary power to detain people (claimed to be minor offenders) for enforced “re-education” without judicial review and endorsement by court for up to two years. This is already a controversial and draconian clause in Mainland China, after “custody and repatriation” and “re-education through labour” had been abolished.</p><p>He then asked me a few questions: 1.) Do you want your parents to be notified? – I replied yes. He gave the decision document on two-year “re-education” imprisonment to me for sign. Then I realised he indirectly threatened and instructed me. Then I replied “no”. He said I did very well and that is the “attitude”. 2.) If no, why? Because you feel shameful? – “yes”; 3.) Had you been tortured or enforced to confess? – “No”; 4.) Did the police treat you well? – “Yes”; 5.) Why didn’t you ask for a lawyer? – “I am too shameful to ask for help”. Then he turned on the camera filming my confession.</p><p>Suddenly, one uniformed officer came in the room, I recognised him as the one who brought the “decision document” for me to sign in the custody in Day 2 or 3. He gave me around seven decision papers to sign again, and some content fields (such as dates) are all blank. I had shown “cooperative attitude” so I signed with fingerprints.</p><p>That uniformed officer asked me out to the front lobby of the detention centre, instructed me to take my name plate and to show it in front of my chest, and started filming my apology and confession for “soliciting prostitution”.</p><p>I was taken back to the interrogation room, and the plainclothes officer passed two A4 papers to me and requested I prepare two “written statements of repentance”, one for “soliciting prostitution” and one for “betraying the motherland”. After review, I was asked to recite it, and they filmed it.</p><p>After all the paperwork, written statements, and filming of confession had been done, he felt happy and told me that based on my “cooperative attitude”, I will be released as proposed at 15 days and this would be the last interrogation. That is the first time I received reassurance on my exact detention period and future.</p><p>I felt extremely relieved and bowed deeply to him, saying thank you again and again. Then he allowed me to leave and go back to the cell. That was the moment I can finally begin to feel mentally stable and have a calmer sleep.</p><p>However, they reversed what they decided and around Day 13 and 14 a brand-new team of secret police came and summoned me to have new round of interrogation. This round lasted the longest ever, continuously for 48 hours. 3 officers in the interrogation room, and around 5 officers, as a back-up team, were standing by in the next room. They maintained a gentle manner which I had rarely experienced throughout my whole detention.</p><p>One of the interrogators, seemingly a leader of the team, started to have a chat with me gently – a “good cop” routine. Firstly, he tried talking in my hometown dialect, Hakka, and he mentioned he once served for three years in my ancestral homeland, stating he is familiar with my relatives and parents in Mainland China. I felt that is a double-edged tactics showing a sense of familiarity and intimacy to me, while threatening to target my relatives and family who were, who are, and who will be in mainland.</p><p>He claimed he has a deep connection with my hometown and regarded me as his hometown fellow. Originally, he was not supposed to see me but because of his sympathy to my case, he tried his best to meet me and help before the senior leaders make a decision on my case. After doing a background check, he also claimed, he felt very sad that such an intelligent and honourable man with a promising future could be ruined if sentenced to two-year imprisonment or more, and how sorry my family and hometown relatives would be. He reiterated my academic and professional achievements were not easy for someone from a grassroot family, and this should make all those in my ancestral hometown proud. He had tried to show he is the last hope and saviour to get me out.</p><p>He mentioned the senior leaders think my “attitude” is still lukewarm, 50-50, meaning I would probably be further incarcerated. Again, they want to see my “cooperative attitude” – by digging out more information from me.</p><p>Another junior and younger interrogator, who was also responsible for jotting down notes, mentioned they had reinstalled deleted social media apps (Telegram, WhatsApp, and others) on my mobile phone, and accessed and backed up the data on their computers, including sensitive conversations from my work email. He was suddenly interrupted by the senior team leader, hinting that shouldn’t have been told to me.</p><p>To “the UK’s role behind the Hong Kong protests”, they printed out the email conversations about the British Consulate’s instructions, procedures and labour division between UK-based and locally-engaged staff to collect information about the protests in Hong Kong, and the list of staff for this mission. They instructed me to film that I handed over the papers to them “voluntarily”, and they warned me not to speak out as I would probably be charged by the UK for “leaking sensitive and internal information”. They also asked if anyone has, or who I suspected has, military or state security background involved in the mission and is collecting information in Hong Kong. They can identify few in the mailing list shown on the papers.</p><p>To “my role in the Hong Kong protests”, they asked when, which, and how did I join the protests, and accessed Telegram to search for details. They gave me an A4 paper to write down the difference between “valour bloc” and “peaceful bloc” amongst the protestor groups, and what is the “reactive valorous” (self-defensive vigilante for protecting peaceful protestors) and “pro-active valorous” (water-revolutionary front hardliners). They found several telegram channels are “valour blocs” then asked if there was someone who had British military background in the channel. I remember one group had and replied yes. However, I don’t know the details as that is just a “reactive valorous” group which organised people to do gym and to teach self-defence martial arts amongst the unknown netizens. I was just a channel browser and didn’t join any gathering.</p><p>They also asked me to draft an “organisational chart” of the “pro-active valorous” group which they had found from my Telegram, then they ordered the back-up team to remodel the chart to be more sophisticated on the computer. Afterwards, they gave me a pile of photos (some are passport-style profile photos), once I recognise someone I know, they ordered me to write down his or her name, their political affiliation, whether they are peaceful or valour protestors, then sign with fingerprints. From their perspective, there is no difference between peaceful or valour protestors as they are coordinated and don’t blame each other, therefore they are the “culprits” no matter people joined peacefully or violently, legally or illegally. They finally identified few key activists and other peripheral participants.</p><p>The secret police clearly stated that batches after batches of Hong Kong protestors had been caught, delivered and detained in Mainland China, so they collected and mutually verified the information amongst different sources and detainees. They also asked if I safeguarded the Lennon Wall in Jordan and showed me a picture of the posters on the wall there. That photo is not from my mobile phone, I suspect they have eyes and ears for gathering information in Hong Kong.</p><p>To “my relations with mainlanders who joined the protests”, they asked the details of where, when and how we met, and which protests did we join in Hong Kong. They targeted one of the mainland protestors who had been arrested by Hong Kong police, and asked if he supported the protestor groups by selling equipment, clothing, printed posters purchased and delivered from Mainland China, and what is the networks of people and resources behind him in the Mainland. He is a liberal and was previously a mainland journalist but didn’t survive after facing media censorship. Secret police put him on the target list after he bought and sold books, including sensitive and politically prohibited books, from Hong Kong and Taiwan to Mainland China. Although he is not well-educated and is less respected in society (when I was asked how we met, I explained we both love to discuss social issues in study circles and media groups, some interrogators doubted this, as elitists usually think, thinking it seemed like I discussed a professional subject with a farmer), but he does love reading books. That’s probably the reason that his unhappy experience facing media censorship, the hardship for making a living in Mainland China, and the books from outside of China he read, finally moulded him into a radical liberal against one-party and authoritarian China. This mainlander was on bail in Hong Kong then was sent back to Mainland China on 11 August. Since then, he has been in criminal detention for unknown charges without any updates. He was forced to “confess” that I helped advise him on political asylum and/ or paid his bail, which I already unequivocally denied. I realise they aimed to financially link the UK, me, and him together.</p><p>Summarising three types of question in the interrogations: they firmly believe the UK is one of the foreign powers to meddle with the Hong Kong protests; the protest itself is well organised and not truly leaderless; and I was suspected of being a mastermind and British proxy to incite and organise the protests in Hong Kong, a core member of “valour group” joining the riots violently, and to instruct or coordinate the mainland liberals against one-party authoritarian system to bring a “colour revolution” to Mainland China. Rather than finding the truth, the interrogations are more likely to fulfil and prove their pre-written play by filling in the information they want from the detainees. In that situation, I believe they intended to further charge me with either 1.) subversion; 2.) armed rebellion and rioting; 3.) espionage; or 4.) betrayal, as the first and second charges and the further administrative detention by “re-education by sheltering” had been clearly mentioned and using as threats during interrogations.</p><p>The secret police also asked my relations with prominent “anti-Chinese” politicians and activists, such as Chris Patten, Alex Chow and Edward Leung. While talking about the meet-up with Edward Leung in London, they noted one LSE lecturer/ researcher from Taiwan had introduced Edward and had an afternoon tea with me, asking if this LSE lecturer/ researcher intended to persuade Edward not to face the trial in Hong Kong by providing job support back in Taiwan. No matter how I clarified that lecturer had no intention to encourage illegal and politically motivated action against Chinese authorities, they insisted to include in a written confession signed with fingerprints that they are a “Taiwanese agent who aimed to support Edward Leung continuously work on secessionist movement for Hong Kong and Taiwan”.</p><p>They kept asking whether I have second or more fake identities, and if I took any photo within or outside of government buildings in Mainland China. I clearly denied. These questions made me feel they still suspected I am a British agent. After my release it made me think of the 44-year-old Taiwanese, Lee Meng-chu, as I heard and read the news after my release that he had been criminally detained since 20 August for “suspected engendering Chinese state security” after taking pictures of paramilitary police amassing on the border between Shenzhen and Hong Kong.</p><p>One uniformed officer came over and redid the written confession record, apology statement letter, and confession tape for “soliciting prostitution”, then left. The secret police were back and did confession letters and tapes again for “betrayal to the motherland”, and instructed me to sing a Chinese national anthem, while recorded by their mobile phone, then sent to senior leaders. I had shown my “cooperative attitude”. Afterwards, the secret police said the senior leaders are happy about my attitude, and he guessed I would likely be confirmed to be released on time.</p><p>Finally, the secret police said I should remember the hardship that my relatives and family had gone through in Mainland and raised me up to be an adult (they noted my parents fled from Mainland China during the great famine just after the Cultural Revolution in 1970s, then I was born in British Hong Kong). They also said I should take care of ancestral house and assets in Mainland. I can sense that is the hidden threat targeting my relatives and assets in Mainland China. Moreover, they clearly stated that if I receive media interviews and speak out anything other than “soliciting prostitution” publicly, I will be taken back to Mainland China from Hong Kong, that is an obvious threat to personal safety. They hinted I am already on the spotlight of the media, telling me although I will be released, the real ordeal is just beginning. That was the time they leaked the specific name of the charge to the Chinese party mouthpieces. They claimed they originally didn’t intend to play smear tactics but the foreign media, which they described as the true devil, gave them no choice but to go public.</p><p>Afterwards, the secret police left for the next room, and two middle-aged men came into the room. They claimed they work for the China’s Hong Kong and Macao Affairs Office. They reiterated they were not here to do “political correctional education and united front works” as they believe I am too well-educated on politics and can’t be persuaded. However, I was asked about my philosophy on freedom and democracy, then they insisted to elaborate the rationales on “why western democratic system is not suitable to China”, and the preaching lasted for almost several hours.</p><p>They asked me to take a side and that I should work for my motherland – China. They said although we have different political beliefs and opinions, they are open to listening and discussing because we are still fellowmen as Chinese. They hope I can be their “friend” after my release. One of the men called himself Mr. Wang, he left a phone number to me (he jotted down the number on a small paper, and showed me; he said he will leave this paper to detention centre staff, and they will give me after I am released. They didn’t at the end however.). Mr Wang said if I need any help or meet any difficulty, then I can give him a ring. He also hinted, as they are working on Hong Kong affairs for Chinese authorities, lots of colleagues are working and staying in Hong Kong, so it is not hard to “see and meet” me in Hong Kong. It made me think they tried to make me an external source or even spy for Chinese authorities, and it also reminded me of the previous warning made by the secret police that I should “behave myself”, otherwise I may be taken back to Mainland from Hong Kong.</p><p>When finished with all the above questionings jointly made by the State Security Bureau and the Hong Kong and Macao Affairs Office, it was already the midnight and early morning of 24 August. They sent me back to solitary confinement in a call for a several-hour break, then asked me out again. This time was the turn for uniformed police who are the senior managers for this detention centre. They politely invited me into a decent reception room, two senior police officers also sit in front of me, asked me to sit on a soft pad chair, and handed me a script (which the questions and answers were totally designed by them in advance) for filming my “confession” and “testimony” against a well-decorated background. Through this filming they tried to show I was treated humanely in a good condition and environment, which is not true, as they put specific restrictions on my activities, denied contact with family, and put me in solitary confinement. However, they did treat me slightly better than the secret police in general, and the later interrogators had shown slightly gentler manner than the earlier interrogators. I believe the media coverage had changed their attitude.</p><p>They filmed several times and picked the best one. They then instructed me to write a letter to “apply for an earlier release”, and the reason is “avoiding the crowds at the port to Hong Kong”. When finished, they almost immediately packed and returned my phone, bag, personal items, clothing, and glasses, I finally had clear vision. They escorted me out of the detention centre at around 5:30 am on 24 August. Around 10 senior ranking police officers and guards saw me off from the centre gate.</p><p>Around 7 plainclothes and masked agents (didn’t even wear badges) surrounded two blue Shenzhen electric taxis parked outside that had been waiting for me. They put me into the front taxi, two sat around me, and one next to the driver, while the others got in the second taxi behind. They kept silent the the entire time. After a 30-minute drive, I was delivered to the car park at the Luohu Port, where around 10 other uniformed and plainclothes officers were waiting for me, some of them wore cameras and filmed this process.</p><p>They surrounded me and walked me out through the passage of the port, the people who were also on the same way crossing the border looked at me in wonder. The whole scene was of a targeted person in the police spotlight, which made me feel uneasy at that time. They escorted me through special channel and stopped following me on the bridge toward Hong Kong above the Shenzhen River.</p><p>I can finally contact my family, close friends, and girlfriend. I took East Railway Train to Kowloon and stayed in a hotel for a few days, as the Chinese secret police had asked for my home and dorm addresses during the questionings and I did not feel safe there. The British[w5]  Consulate officials came and visited.</p><p>Later that week, my office sent a diplomatic car to take me to the Consulate building, and I did a debrief on my detention to the senior officials. The Embassy security asked me to be cautious if there have suspicious people follow me, esp. those who wear bracelet.[w6]</p><p>In regards to the threat made by Chinese secret police that they can “abduct me back to Mainland China in Hong Kong anytime if I don’t behave myself, such as exposing their hidden political motivation and agenda behind my detention to anyone”, I was granted a several-month paid leave by the Consulate and I have fled to a third place and foreign country for security reasons.”</p><p>Before leaving Hong Kong, I had to cancel my missing person case with Hong Kong police. Two junior and one senior Hong Kong police officers handled my case. One of the juniors has called me since Day 1 after my release and has kept asking me to cancel the case once I feel comfortable. They acted in a compassionate and kind manner, mentioned I was advised to do the cancellation in a private and secure place for better privacy in order to avoid press and public attention. They sent a private van to meet me in front of the Yaumati Catholic Primary School. When I went there by taxi, I saw one suspicious man who was wearing a bracelet standing and looking around, and his van was parked right behind the police’s private van. Those three Hong Kong police officers got down and showed their badges to me. I told them I felt unsafe so refused to get into their car and took a taxi to Yau Ma Tei Police Station myself. Hong Kong police replied that they understood my concern and they agreed to meet me in the police station soon. When I got out of the taxi in front of the main gate of the police station, I also saw another suspicious man who was also wearing a bracelet and was leaning against the wall looking at his mobile phone. There are not many stores, facilities and residences near the front of police station. I suspect these two suspicious men were Chinese undercover agents who tried tracking and monitoring me, a clear warning that I should not say anything to the Hong Kong police about my detention in Mainland China so they do not record it on Hong Kong official papers and police statements.</p><p>Inside the police station, I met the trio handling my case. They invited me into a questioning room (which is absolutely more humane and better than Mainland, no “tiger chair” and “cell” in the room at least). They asked me what happened and what had I gone through since I disappeared, “sorry but I can’t tell” I replied. The senior police officer elaborated more: “may I know if you don’t want to tell, or you can’t tell?” I confirmed that “It is - I can’t”. They nodded and showed understanding, then they filled out the paperwork and finally cancelled my missing person case. They maintained a polite and respectful manner.</p><p>After cancelling my missing person case in Hong Kong, I fled from Hong Kong to the third place, and started negotiation on the solution and severance package with the UK Government. I was asked to resign on November 2019 and which ended my roughly 2-year service and employment.</p><p>I am seeking asylum by getting right of abode and landing work and study opportunities. However, I cannot do much without concrete support. I am now vulnerable after seeing no concrete support and protection at the moment. I shall try and make a living myself and try to seek help from civil society - I sincerely hope the civil society can assist me in returning to normal life and re-entering the labour market, as now my future is still uncertain and insecure.</p><p>I won’t give up the fight for human rights, peace, freedom and democracy for the rest of my life, no matter the danger, discrimination and retaliation I will face, and no matter how my reputation will be stained, and no matter whether my future would be blacklisted, labelled, and ruined.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>test</title>
      <link href="/2019/11/17/test/"/>
      <url>/2019/11/17/test/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>大叔</title>
      <link href="/2019/10/29/yu-bo-le-ji/"/>
      <url>/2019/10/29/yu-bo-le-ji/</url>
      
        <content type="html"><![CDATA[<p>今天面试Python人工智能，紧张且忐忑不安地在面试屋里等。先进来一位干净和蔼的大叔，问我喜欢欢那本书，答《麦田里的守望者》，没想到他竟然也读过，还记得去过主人公离家出走到纽约的公园，这对我冲击太大了，以至于语无伦次，后面的表现糟糕地一塌糊涂。</p><p>《麦田》是我早高中最喜欢的书，当时书店里就一本损坏的，在书店读了一半后就迫不及待地买了回去，那时我第一次，抱着一本书，一句一句地读，一遍又一遍，仿佛每一个字都饱含深意，热泪盈眶，难以自己，到了早上三四点仍精神振奋，好像有千言万语要说。也因此喜欢上译者孙仲旭，买了很多他翻译的书看。后来他的自杀对我冲击之大也是可想而知的。</p><p>可我几乎没有和人谈读书的，从高中时就和身边人有了明显的隔阂，书就像是我自己一片独立而不受外部干扰的世界一样，今天和那位面试官问我为什么喜欢时，我张口结舌，从未想过该如何回答这个问题，不知道该回答到什么程度（我很清楚面试官要的是什么人的）。</p><p>但是今天面试结束的时候我兴奋异常，在路上就下定决心要去这家公司，这个岗位不要我就去面试其他岗位。</p><p>说到底，你能碰到几个能和你聊《麦田》的人呢？更何况是在公司里。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>我不配</title>
      <link href="/2019/10/24/wo-bu-pei/"/>
      <url>/2019/10/24/wo-bu-pei/</url>
      
        <content type="html"><![CDATA[<p>自称Vim党，结果别人一问三不知，丢人到家了，看家本领都丢了，以后，我叫Vim学员。</p><p>反思：不要慌啊，问我怎么配置Vim的Java运行环境，怎么同时打开多个文件并且切换，怎么看日志等，放下手机，仔细想想还是能答一些的，但当时就是答不出来，脑子一排空白，难道我真的要背诵下面试宝典这类东西。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>v2ray全局配置</title>
      <link href="/2019/10/24/v2ray-quan-ju-pei-zhi/"/>
      <url>/2019/10/24/v2ray-quan-ju-pei-zhi/</url>
      
        <content type="html"><![CDATA[<p><a href="[https://xdays.me/V2RAY%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86/](https://xdays.me/V2RAY透明代理/)">请看链接</a></p><h2 id="重定向TCP流量"><a href="#重定向TCP流量" class="headerlink" title="重定向TCP流量"></a>重定向TCP流量</h2><pre class="line-numbers language-bash"><code class="language-bash">iptables -t nat -N V2RAY<span class="token comment" spellcheck="true"># Ignore your V2Ray outbound traffic</span><span class="token comment" spellcheck="true"># It's very IMPORTANT, just be careful.</span>iptables -t nat -A V2RAY -p tcp -j RETURN -m mark --mark 0xff<span class="token comment" spellcheck="true"># Ignore LANs and any other addresses you'd like to bypass the proxy</span><span class="token comment" spellcheck="true"># See Wikipedia and RFC5735 for full list of reserved networks.</span>iptables -t nat -A V2RAY -d 0.0.0.0/8 -j RETURNiptables -t nat -A V2RAY -d 10.0.0.0/8 -j RETURNiptables -t nat -A V2RAY -d 127.0.0.0/8 -j RETURNiptables -t nat -A V2RAY -d 169.254.0.0/16 -j RETURNiptables -t nat -A V2RAY -d 172.16.0.0/12 -j RETURNiptables -t nat -A V2RAY -d 192.168.0.0/16 -j RETURNiptables -t nat -A V2RAY -d 224.0.0.0/4 -j RETURNiptables -t nat -A V2RAY -d 240.0.0.0/4 -j RETURN<span class="token comment" spellcheck="true"># Anything else should be redirected to Dokodemo-door's local port</span>iptables -t nat -A V2RAY -p tcp -j REDIRECT --to-ports 1099<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意这里有一个关键规则<code>iptables -t nat -A V2RAY -p tcp -j RETURN -m mark --mark 0xff</code>，这个规则就是为了排除v2ray要发出去的流量，没有这个规则的话就成死循环了，v2ray要发出去的流量又被重定向给了v2ray。</p><p>然后分别在<code>PREROUTING</code>和<code>OUTPUT</code>连个链里应用我们新建的<code>V2RAY</code>链，前者是为了重定向其他设备过来的TCP流量，后者是重定向本机发出的TCP流量。</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># apply redirect for traffic forworded by this proxy</span>iptables -t nat -A PREROUTING  -p tcp -j V2RAY<span class="token comment" spellcheck="true"># apply redirect for proxy itself</span>iptables -t nat -A OUTPUT -p tcp -j V2RAY<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="重定向UDP流量"><a href="#重定向UDP流量" class="headerlink" title="重定向UDP流量"></a>重定向UDP流量</h2><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># UDP Redirect</span>iptables -t mangle -N V2RAYiptables -t mangle -A V2RAY -p udp -j RETURN -m mark --mark 0xffiptables -t mangle -A V2RAY -p udp --dport 53 -j TPROXY --on-port 1099 --tproxy-mark 0x01/0x01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>注意这里也有一个关键规则<code>iptables -t mangle -A V2RAY -p udp -j RETURN -m mark --mark 0xff</code>目的和TCP REDIRECT里的一样，避免死循环。</p><p>然后配置策略路由，按mark匹配流量，将流量路由到本机回环接口。</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># add route for udp traffic</span>ip route add local default dev lo table 100ip rule add fwmark 1 lookup 100<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>注意，这条路由规则的类型是<code>local</code>，我的理解内核把<code>TPEOXY</code>和路由关联起来了</p><p>最后就是，把这条链应用到<code>PREROUTING</code>链里，这样就能重定向其他设备过来的UDP流量了。</p><pre class="line-numbers language-bash"><code class="language-bash">iptables -t mangle -A PREROUTING -j V2RAY<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>好像还没有完，我们还没有重定向本机发出的UDP流量，这也是我目前的一个困惑点。先说我的做法吧，我再mangle表的<code>OUTPUT</code>链里添加了如下两条规则：</p><pre class="line-numbers language-bash"><code class="language-bash">iptables -t mangle -N V2RAY_MARKiptables -t mangle -A V2RAY_MARK -p udp -j RETURN -m mark --mark 0xffiptables -t mangle -A V2RAY_MARK -p udp --dport 53 -j MARK --set-mark 1iptables -t mangle -A OUTPUT -j V2RAY_MARK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>第一条规则仍然是排除v2ray自己的流量，第二条是给UDP数据包打上了mark，而只是打上mark怎么就出发上面的重定向规则嘞？目前我的比较粗浅的理解就是上面数据包流程图里mangle的<code>OUTPUT</code>链会触发reroute check，也就让数据包重新从<code>PREROUTING</code>链走了一遍。</p><h2 id="there"><a href="#there" class="headerlink" title="there"></a>there</h2><p>编写iptables操作脚本</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true"># TCP Redirect</span>    <span class="token comment" spellcheck="true"># Create new chain</span>    iptables -t nat -N V2RAY    <span class="token comment" spellcheck="true"># Ignore your V2Ray outbound traffic</span>    <span class="token comment" spellcheck="true"># It's very IMPORTANT, just be careful.</span>    iptables -t nat -A V2RAY -p tcp -j RETURN -m mark --mark 0xff    <span class="token comment" spellcheck="true"># Ignore LANs and any other addresses you'd like to bypass the proxy</span>    <span class="token comment" spellcheck="true"># See Wikipedia and RFC5735 for full list of reserved networks.</span>    iptables -t nat -A V2RAY -d 0.0.0.0/8 -j RETURN    iptables -t nat -A V2RAY -d 10.0.0.0/8 -j RETURN    iptables -t nat -A V2RAY -d 127.0.0.0/8 -j RETURN    iptables -t nat -A V2RAY -d 169.254.0.0/16 -j RETURN    iptables -t nat -A V2RAY -d 172.16.0.0/12 -j RETURN    iptables -t nat -A V2RAY -d 192.168.0.0/16 -j RETURN    iptables -t nat -A V2RAY -d 224.0.0.0/4 -j RETURN    iptables -t nat -A V2RAY -d 240.0.0.0/4 -j RETURN    <span class="token comment" spellcheck="true"># Anything else should be redirected to Dokodemo-door's local port</span>    iptables -t nat -A V2RAY -p tcp -j REDIRECT --to-ports 1099    <span class="token comment" spellcheck="true"># apply redirect for traffic forworded by this proxy</span>    iptables -t nat -A PREROUTING  -p tcp -j V2RAY    <span class="token comment" spellcheck="true"># apply redirect for proxy itself</span>    iptables -t nat -A OUTPUT -p tcp -j V2RAY    <span class="token comment" spellcheck="true"># UDP Redirect</span>    iptables -t mangle -N V2RAY    iptables -t mangle -A V2RAY -p udp -j RETURN -m mark --mark 0xff    iptables -t mangle -A V2RAY -p udp --dport 53 -j TPROXY --on-port 1099 --tproxy-mark 0x01/0x01    iptables -t mangle -N V2RAY_MARK    iptables -t mangle -A V2RAY_MARK -p udp -j RETURN -m mark --mark 0xff    iptables -t mangle -A V2RAY_MARK -p udp --dport 53 -j MARK --set-mark 1    <span class="token comment" spellcheck="true"># add route for udp traffic</span>    ip route add local default dev lo table 100    ip rule add fwmark 1 lookup 100    <span class="token comment" spellcheck="true"># Apply the rules</span>    <span class="token comment" spellcheck="true"># apply udp tproxy for traffic forworded by this proxy</span>    iptables -t mangle -A PREROUTING -j V2RAY    <span class="token comment" spellcheck="true"># apply udp tproxy for proxy itself</span>    iptables -t mangle -A OUTPUT -j V2RAY_MARK<span class="token punctuation">}</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    iptables -t nat -D PREROUTING  -p tcp -j V2RAY    iptables -t nat -D OUTPUT -p tcp -j V2RAY    iptables -t nat -F V2RAY    iptables -t nat -X V2RAY    iptables -t mangle -D PREROUTING -j V2RAY    iptables -t mangle -F V2RAY    iptables -t mangle -X V2RAY    iptables -t mangle -D OUTPUT -j V2RAY    iptables -t mangle -F V2RAY_MARK    iptables -t mangle -X V2RAY_MARK    ip rule del fwmark 1 lookup 100    ip route del local default dev lo table 100<span class="token punctuation">}</span><span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>start<span class="token punctuation">)</span>    start    <span class="token punctuation">;</span><span class="token punctuation">;</span>stop<span class="token punctuation">)</span>    stop    <span class="token punctuation">;</span><span class="token punctuation">;</span>*<span class="token punctuation">)</span>    <span class="token keyword">echo</span> <span class="token string">"<span class="token variable">$0</span> start|stop"</span>    <span class="token punctuation">;</span><span class="token punctuation">;</span>esac<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后是服务管理脚本</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span> /etc/rc.common<span class="token comment" spellcheck="true"># "new" style init script</span><span class="token comment" spellcheck="true"># Look at /lib/functions/service.sh on a running system for explanations of what other SERVICE_</span><span class="token comment" spellcheck="true"># options you can use, and when you might want them.</span>START<span class="token operator">=</span>80STOP<span class="token operator">=</span>20APP<span class="token operator">=</span>v2raySERVICE_WRITE_PID<span class="token operator">=</span>1SERVICE_DAEMONIZE<span class="token operator">=</span>1PREFIX<span class="token operator">=</span>/usr/local/v2raystart<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    service_start <span class="token variable">$PREFIX</span>/v2ray -config <span class="token variable">$PREFIX</span>/client_proxy.json    <span class="token variable">$PREFIX</span>/client_proxy.sh start<span class="token punctuation">}</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$PREFIX</span>/client_proxy.sh stop    service_stop <span class="token variable">$PREFIX</span>/v2ray<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后启用脚本，开机启动</p><pre class="line-numbers language-bash"><code class="language-bash">/etc/init.d/v2ray start/etc/init.d/v2ray <span class="token function">enable</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> v2ray </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>视频面试总结</title>
      <link href="/2019/10/22/shi-pin-mian-shi-zong-jie/"/>
      <url>/2019/10/22/shi-pin-mian-shi-zong-jie/</url>
      
        <content type="html"><![CDATA[<p>​        第一次视频面试，紧张的很，乱记一番。</p><p>​        先是技术面试，先是Vim,Vim能代替IDE吗？当然不能，这个问题我可以自言自语说很久的，结果当时只能说个不能，语无伦次，颠三倒四，问到一个Vim技巧，结果我不会（我不配叫Vim党）。再问Docker，有什么优势，这是我的看家本领，问我Docker数据库相关的，结果我又卡住了，这的确是我不知道的，为啥要在数据库运行的时候删除镜像呢？，两三句就说完了，在此就在冒冷汗了。再问我的项目，怎么判断五子棋一方胜利的更好的方法，我愣了，好，下一个，Linux相关的，我精神一振，对Linux的各个发行版本我可是很了解哈，当年把主流的发行版都用了个遍，结果连centos和fedora的发音都发错（可以想象技术面试官的脸色已经变冷了）。接着是算法题目，查找中间数，我头脑一片空白。再问我K8s,不要描述也能猜到吧。     面试结束后，我想想，其实有很多可以说的，还是自己不足，没经验，这样的表现要我是面试官都不会要我。</p><p>​        然后是人事面试，，能感觉到是很好的人，细致敏感聪慧。问我为什么不喜欢与人讨论读书感想，果然，这句话不该放在简历里面的。为什么呢？因为当代中国的学生是不读书的，除了教材。在高中时，我抱着《麦田里的守望者》一句一句的读，熬到晚上四点多仍精神振奋难以入眠。读了中文的还不够，强行读英文原版。可这怎么和人讨论呢，现在的教育把人教育成了空心菜，把人以机器为目的练，有自己思想的人必然会和这样的教育体制有冲突。可是这些怎么和面试官说呢？只好搪塞过去了。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Command Line Heroes</title>
      <link href="/2019/10/21/command-line-heroes/"/>
      <url>/2019/10/21/command-line-heroes/</url>
      
        <content type="html"><![CDATA[<p>命令行英雄，讲得非常好唔，学到很多</p><p><a href="https://www.redhat.com/en/command-line-heroes" target="_blank" rel="noopener"><a href="https://www.redhat.com/en/command-line-heroes" target="_blank" rel="noopener">https://www.redhat.com/en/command-line-heroes</a></a></p>]]></content>
      
      
      <categories>
          
          <category> redhat </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redhat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>找工作需要注意的</title>
      <link href="/2019/10/21/zhao-gong-zuo-xu-yao-zhu-yi-de/"/>
      <url>/2019/10/21/zhao-gong-zuo-xu-yao-zhu-yi-de/</url>
      
        <content type="html"><![CDATA[<p>请看链接：<a href="https://www.zhihu.com/question/48240919" target="_blank" rel="noopener">https://www.zhihu.com/question/48240919</a></p><p>小心喔</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>DnsPod</title>
      <link href="/2019/10/20/dnspod/"/>
      <url>/2019/10/20/dnspod/</url>
      
        <content type="html"><![CDATA[<p>不要相信国产牛皮，一个个吹得能上天，号称超快速度的，结果这个域名解析不到，赶紧去了，就恢复了，哎</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>The Marvelous Mrs. Maisel</title>
      <link href="/2019/10/19/the-marvelous-mrs-maisel/"/>
      <url>/2019/10/19/the-marvelous-mrs-maisel/</url>
      
        <content type="html"><![CDATA[<p>了不起的麦瑟尔夫人</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>That Don&#39;t Make it Junk</title>
      <link href="/2019/10/19/leonard-cohen/"/>
      <url>/2019/10/19/leonard-cohen/</url>
      
        <content type="html"><![CDATA[<p>I’ll listen to the darkness sing<br>I know what that’s about.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>illegalcharacter:﻿error</title>
      <link href="/2019/10/19/illegalcharacter-ufefferror/"/>
      <url>/2019/10/19/illegalcharacter-ufefferror/</url>
      
        <content type="html"><![CDATA[<p>UTF-8格式编码与UTF-8无BOM格式编码的区别<br>你看，windowns缺点有多少，我得专门写一篇diss windows.<br>在UCS 编码中有一个叫做”ZERO WIDTH NO-BREAK SPACE”的字符，它的编码是FEFF。而FFFE在UCS中是不存在的字符，所以不应该出现在实际传输中。UCS规范建议我们在传输字节流前，先传输字符”ZERO WIDTH NO-BREAK SPACE”。这样如果接收者收到FEFF，就表明这个字节流是Big-Endian的；如果收到FFFE，就表明这个字节流是Little-Endian的。因此字符”ZERO WIDTH NO-BREAK SPACE”又被称作BOM。</p><p>UTF-8不需要BOM来表明字节顺序，但可以用BOM来表明编码方式。字符”ZERO WIDTH NO-BREAK SPACE”的UTF-8编码是EF BB BF。所以如果接收者收到以EF BB BF开头的字节流，就知道这是UTF-8编码了。</p><p>UTF-8编码的文件中，BOM占三个字节。如果用记事本把一个文本文件另存为UTF-8编码方式的话，用UE打开这个文件，切换到十六进制编辑状态就可以看到开头的FFFE了。这是个标识UTF-8编码文件的好办法，软件通过BOM来识别这个文件是否是UTF-8编码，很多软件还要求读入的文件必须带BOM。可是，还是有很多软件不能识别BOM。</p><p>在Firefox早期的版本里，扩展是不能有BOM的，不过Firefox 1.5以后的版本已经开始支持BOM了。现在又发现，PHP也不支持BOM。PHP在设计时就没有考虑BOM的问题，也就是说他不会忽略UTF-8编码的文件开头BOM的那三个字符。</p><p>由于必须在在Bo-Blog的wiki看到，同样使用PHP的Bo-Blog也一样受到BOM的困扰。其中有提到另一个麻烦：“受COOKIE送出机制的限制，在这些文件开头已经有BOM的文件中，COOKIE无法送出（因为在COOKIE送出前PHP已经送出了文件头），所以登入和登出功能失效。一切依赖COOKIE、SESSION实现的功能全部无效。”这个应该就是Wordpress后台出现空白页面的原因了，因为任何一个被执行的文件包含了BOM，这三个字符都将被送出，导致依赖cookies和session的功能失效。</p><p>解决的办法嘛，如果只包含英文字符(或者说ASCII编码内的字符)，就把文件存成ASCII码方式吧。用UE等编辑器的话，点文件-&gt;转换-&gt;UTF-8转ASCII，或者在另存为里选择ASCII编码。如果是DOS格式的行尾符，可以用记事本打开，点另存为，选ASCII编码。如果包含中文字符的话，可以用UE的另存为功能，选择“UTF-8 无 BOM”即可。</p>]]></content>
      
      
      <categories>
          
          <category> utf-8 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> diss windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>telegram</title>
      <link href="/2019/10/18/telegram/"/>
      <url>/2019/10/18/telegram/</url>
      
        <content type="html"><![CDATA[<p>以后要把telegram好好写一下（以后必系列），用什么国产软件，直教人火冒三丈，程序员就有点程序员的样子嘛</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>May I</title>
      <link href="/2019/10/18/may-i/"/>
      <url>/2019/10/18/may-i/</url>
      
        <content type="html"><![CDATA[<p>Is it just me, or is it getting crazier out there?</p>]]></content>
      
      
      
        <tags>
            
            <tag> joker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>about education</title>
      <link href="/2019/10/18/about-education/"/>
      <url>/2019/10/18/about-education/</url>
      
        <content type="html"><![CDATA[<p>终于要离开了，没想到吧！</p>]]></content>
      
      
      <categories>
          
          <category> Not telling you </category>
          
      </categories>
      
      
        <tags>
            
            <tag> a single tear </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>找实习感想</title>
      <link href="/2019/10/17/zhao-shi-xi-gan-xiang/"/>
      <url>/2019/10/17/zhao-shi-xi-gan-xiang/</url>
      
        <content type="html"><![CDATA[<p>这段时间以来都不能专心写代码，考虑找实习的事情，想找个南方的公司，那样实习后就可以直接留在公司了，<br>不然一毕业又要重新找工作，可是在学校又有一堆事情。<br>终于快从这个教育体系里离开了，思考起来，除了小学的一位语文老师，我对整个的教育体系，队伍都是充满恨意的，恨之入骨，<br>但这份情感是难于和人说的，我很不喜欢和人挤在一间屋子，住在一间屋子的，为什么只能在学校读书的可以中高考？这份恨意如此之深，可能永远都不能散去了。</p>]]></content>
      
      
      
        <tags>
            
            <tag> diss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>程序员的通信软件</title>
      <link href="/2019/10/17/cheng-xu-yuan-de-tong-xin-ruan-jian/"/>
      <url>/2019/10/17/cheng-xu-yuan-de-tong-xin-ruan-jian/</url>
      
        <content type="html"><![CDATA[<p>seriously,你个学程序的用QQ，Wechat？？？</p><p>对QWB恨之入骨的啊。</p>]]></content>
      
      
      
        <tags>
            
            <tag> diss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python生成词云教程</title>
      <link href="/2019/10/16/python-sheng-cheng-ci-yun-jiao-cheng/"/>
      <url>/2019/10/16/python-sheng-cheng-ci-yun-jiao-cheng/</url>
      
        <content type="html"><![CDATA[<p>其实挺简单的，做了两个，有一个有图形界面，但是不知道放哪儿了，<br><a href="https://github.com/binyang179/wordcloud.git" target="_blank" rel="noopener">wordcloud</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MSI gt62vr</title>
      <link href="/2019/10/15/msi-gt62vr/"/>
      <url>/2019/10/15/msi-gt62vr/</url>
      
        <content type="html"><![CDATA[<p>微星电脑，当初它的可以换显卡的主板吸引了我，毅然决然的入了手，<br>结果刚到没几天就把生命不能承受之六斤重的电脑摔坏了，屏幕转轴处裂开，<br>金属的外壳都凹下去一块。<br>完了，这样下去要沦为废话博客了</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>parrot os</title>
      <link href="/2019/10/15/parrot-os/"/>
      <url>/2019/10/15/parrot-os/</url>
      
        <content type="html"><![CDATA[<p>有个大BUG啊，升级好多次了，一直没解决，分辨率不对，图形都好大的，不过小能手（咳）调整字体后就好了</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>manjaro</title>
      <link href="/2019/10/15/manjaro/"/>
      <url>/2019/10/15/manjaro/</url>
      
        <content type="html"><![CDATA[<p>硬件问题解决的很好，不过mint用习惯了，还是主要是mint</p>]]></content>
      
      
      <categories>
          
          <category> tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>podman</title>
      <link href="/2019/10/15/podman/"/>
      <url>/2019/10/15/podman/</url>
      
        <content type="html"><![CDATA[<p>总结：非root运行非常好，不过没有ip地址，在manjaro下有问题的</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>对不起</title>
      <link href="/2019/10/15/free/"/>
      <url>/2019/10/15/free/</url>
      
        <content type="html"><![CDATA[<p>有时我会陪着你们，因为我也是，我会一直留在这里，等到电视散了之后，我要找到他们的指挥官，所以你们不用担心我，我知道我不想，你为了我而操劳。<br>现在很乱，很多人都深处这个状况之中，但你是否可以，生于斯，死于斯，为什么要这样对待我们，我知道那些命令你不能反抗。</p>]]></content>
      
      
      
        <tags>
            
            <tag> So So Sorry </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Le Petit Prince</title>
      <link href="/2019/10/15/le-petit-prince/"/>
      <url>/2019/10/15/le-petit-prince/</url>
      
        <content type="html"><![CDATA[<p>第一本让我决定学法语的书</p>]]></content>
      
      
      <categories>
          
          <category> book </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lucky to known </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>The Catcher in the Rye</title>
      <link href="/2019/10/15/the-catcher-in-the-rye/"/>
      <url>/2019/10/15/the-catcher-in-the-rye/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> book </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lucky to known </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>django链接mysql</title>
      <link href="/2019/10/15/django-lian-jie-mysql/"/>
      <url>/2019/10/15/django-lian-jie-mysql/</url>
      
        <content type="html"><![CDATA[<h4 id="最新的Django安装和连接mysql会提示mysqclient版本只有0-9几，但实际上你是安装了1-13版本的，这时候就应该"><a href="#最新的Django安装和连接mysql会提示mysqclient版本只有0-9几，但实际上你是安装了1-13版本的，这时候就应该" class="headerlink" title="最新的Django安装和连接mysql会提示mysqclient版本只有0.9几，但实际上你是安装了1.13版本的，这时候就应该"></a>最新的Django安装和连接mysql会提示mysqclient版本只有0.9几，但实际上你是安装了1.13版本的，这时候就应该</h4><p>stackOverFlow了，别问我.<br>不过最新版竟然有这个问题，而且这么就都没有解决.<br>python web跟java web还有差距的啊.</p>]]></content>
      
      
      
        <tags>
            
            <tag> iss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Yasujirō Ozu</title>
      <link href="/2019/10/15/yasujiro-ozu/"/>
      <url>/2019/10/15/yasujiro-ozu/</url>
      
        <content type="html"><![CDATA[<p>小津安二郎</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>燃烧</title>
      <link href="/2019/10/15/ran-shao/"/>
      <url>/2019/10/15/ran-shao/</url>
      
        <content type="html"><![CDATA[<p>《燃烧》电影,导演懂春上的，或者说我懂导演吧</p>]]></content>
      
      
      <categories>
          
          <category> movie&amp;TV series </category>
          
      </categories>
      
      
        <tags>
            
            <tag> movie </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>三五计划</title>
      <link href="/2019/10/15/san-wu-ji-hua/"/>
      <url>/2019/10/15/san-wu-ji-hua/</url>
      
        <content type="html"><![CDATA[<p>立个Flag,以后我要把我看过的书，电影，电视剧都记录下来<br>碰到的问题更要详细的记录，嗯。<br>三个月接入广告，半年财富自由，以后就可以专心为人民服务了</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>타인은지옥이다</title>
      <link href="/2019/09/15/taineunjiogida/"/>
      <url>/2019/09/15/taineunjiogida/</url>
      
        <content type="html"><![CDATA[<h2 id="他人即地狱"><a href="#他人即地狱" class="headerlink" title="他人即地狱"></a>他人即地狱</h2>]]></content>
      
      
      <categories>
          
          <category> movie&amp;TV series </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TV series </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ddrk</title>
      <link href="/2019/07/15/ddrk/"/>
      <url>/2019/07/15/ddrk/</url>
      
        <content type="html"><![CDATA[<h4 id="Don’t-worry-This-is-a-love-story"><a href="#Don’t-worry-This-is-a-love-story" class="headerlink" title="Don’t worry, This is a love story"></a>Don’t worry, This is a love story</h4><p>我指的是ddrk.me这个网站</p>]]></content>
      
      
      <categories>
          
          <category> TV collect </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TV web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Yes,Minister</title>
      <link href="/2019/01/15/yes-minister/"/>
      <url>/2019/01/15/yes-minister/</url>
      
        <content type="html"><![CDATA[<p>Yes,Minister和Yes,Prime Minister资源<br>电子书<br>shareID: 791285259, 链接: <a href="https://pan.baidu.com/s/1GdueO1nl-7CpgGDP87G43A" target="_blank" rel="noopener">https://pan.baidu.com/s/1GdueO1nl-7CpgGDP87G43A</a><br>视频<br>shareID: 1637642534, 链接: <a href="https://pan.baidu.com/s/1697yI0aWfU3IkZBDgWHmgg" target="_blank" rel="noopener">https://pan.baidu.com/s/1697yI0aWfU3IkZBDgWHmgg</a></p>]]></content>
      
      
      <categories>
          
          <category> movie&amp;TV series </category>
          
      </categories>
      
      
        <tags>
            
            <tag> British TV series </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
